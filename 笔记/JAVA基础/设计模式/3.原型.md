# 一. 定义与特点

**定义：**

用一个**已经创建的实例作为原型**，通过**复制**该原型对象来创建一个和原型**相同或相似的新对象**。用这种方式**创建对象非常高效**，根本**无须知道**对象**创建的细节**。



# 二. 优点与缺点

**优点：**

- Java自带的原型模式基于二进制流的复制，在性能上比直接new一个对象更加优良。
- 可以使用深克隆方式保存对象状态，使用原型模式将对象复制一份，并将其状态保存起来，简化创建对象的过程，以便在需要的时候使用（例如恢复到历史的某一状态），可辅助实现撤销操作。

**缺点：**

- 需要为每一个类都配置一个clone方法。
- clone方法位于类的内部，当对已有的类进行改造的时候，需要修改代码，违背开闭原则。
- 当实现深克隆时，需要编写较为复杂的代码，而且当对象之间存在多重嵌套引用时，为实现深克隆，每一层对象对应的类必须支持深克隆，实现起来比较麻烦。因此，深克隆、浅克隆需要运用得当。



# 三. 结构与实现

java 提供了对象的 **clone()方法**，所以用java实现原型模式很简单。



## 1.模式的结构

原型模式包含以下主要角色。

1. 抽象原型类：规定了具体原型对象必须实现的（Cloneable）接口。

2. 具体原型类：实现抽象原型类的 clone() 方法，它是可被复制的对象。

3. 访问类：使用具体原型类中的 clone() 方法来复制新的对象

   

## 2.模式分类

原型模式的克隆分为浅克隆和深克隆。

- ### 浅克隆

  创建一个新对象，新对象的属性和原来对象完全相同，对于非基本类型属性，仍指向原有属性所指向的对象的内存地址。

- ### 深克隆

  创建一个新对象，属性中引用的其他对象也会被克隆，不再指向原有对象地址。



## 3.实现



### 浅克隆

(成员对象类)ShollowCloneExpand.java

```java
@Getter
@Setter
public class ShollowCloneExpand {

    /**
     * 街道
     */
    private String address;

    /**
     * 门牌号
     */
    private int no;

    public ShollowCloneExpand(String address, int no){
        System.out.println("地址信息构造方法调用");
        this.address = address;
        this.no = no;
    }

}
```

(具体原型类)ShollowClone.java

```java
@Getter
@Setter
public class ShollowClone implements Cloneable {

    /**
     * 名称
     */
    private String name;

    /**
     * 年龄
     */
    private int age;

    /**
     * 地址信息
     */
    private ShollowCloneExpand address;

    public ShollowClone(String name, int age, ShollowCloneExpand address){
        System.out.println("个人基本信息构造方法调用");
        this.name = name;
        this.age = age;
        this.address = address;
    }

    public ShollowClone clone() throws CloneNotSupportedException{
        System.out.println("peter被复制了");
        return (ShollowClone) super.clone();
    }

    public static void main(String[] args) throws CloneNotSupportedException {
        /**
         * peter 个人信息
         */
        ShollowCloneExpand peterAddress = new ShollowCloneExpand("广州越秀东风路", 115);
        ShollowClone peter = new ShollowClone("peter", 18, peterAddress);

        /**
         * 复制 peter哥哥 个人信息
         */
        ShollowClone peterBigBrother = peter.clone();
        peterBigBrother.setName("bigBrother");
        peterBigBrother.setAge(19);
        peterBigBrother.getAddress().setAddress("广州越秀建设南路");
        peterBigBrother.getAddress().setNo(30);

        System.out.println("===================复制结果===================");
        System.out.println("是否同一个人：" + (peter == peterBigBrother) + "-----新对象引用与旧对象引用是否值指向同一内存地址");
        System.out.println("哥哥年纪比peter大" +   "，哥哥（" + peterBigBrother.getAge() + ")，peter(" + peter.getAge() + ")：" +(peterBigBrother.getAge() > peter.getAge()) + "-----修改新对象的基本属性，并不会影响原对象的基本属性");
        System.out.println("弟弟随哥哥搬家了，新地址=" + peter.getAddress().getAddress() + peter.getAddress().getNo() + "：" + (peter.getAddress() == peterBigBrother.getAddress()) + "-----非基本类型属性，仍指向原有属性所指向的对象的内存地址");
    }
```

运行结果：

![1604655103(1)](.\pic\1604655216(1).jpg)